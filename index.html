<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rental Car Pricing Strategy Advisor</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'DM Sans', 'Helvetica Neue', sans-serif;
    background: #000000;
    color: #f1f5f9;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #0a0a0a; }
  ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 3px; }
  input[type=range] { -webkit-appearance: none; appearance: none; background: #161616; height: 4px; border-radius: 2px; outline: none; width: 100%; cursor: pointer; }
  input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #eab308; border-radius: 50%; cursor: pointer; }
  input[type=range]::-moz-range-thumb { width: 16px; height: 16px; background: #eab308; border-radius: 50%; cursor: pointer; border: none; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

  .header {
    background: linear-gradient(180deg, #0a0a0a 0%, #000000 100%);
    border-bottom: 1px solid #1f1f1f;
    padding: 28px 32px 20px;
  }
  .header-inner { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; gap: 12; }
  .header-icon {
    width: 42px; height: 42px; border-radius: 10px;
    background: linear-gradient(135deg, #eab308, #fbbf24);
    display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;
  }
  .header h1 {
    font-size: 22px; font-weight: 700;
    background: linear-gradient(135deg, #ffffff, #eab308);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .header p { color: #64748b; font-size: 12px; }

  .container { max-width: 1100px; margin: 0 auto; padding: 24px 32px; }

  /* Fleet Profile */
  .fleet-profile {
    background: #0a0a0a; border: 1px solid #1f1f1f; border-radius: 12px;
    padding: 20px; margin-bottom: 24px;
  }
  .fleet-profile h3 {
    color: #94a3b8; font-size: 12px; letter-spacing: 1.5px;
    text-transform: uppercase; margin-bottom: 16px;
  }
  .fleet-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; }
  .fleet-grid label { color: #64748b; font-size: 12px; display: block; margin-bottom: 6px; }
  .fleet-grid label span { color: #eab308; font-weight: 600; }

  /* AI Advisor */
  .ai-advisor {
    background: linear-gradient(135deg, #1a1700 0%, #0a0a0a 100%);
    border: 1px solid rgba(234,179,8,0.2); border-radius: 12px;
    padding: 20px; margin-bottom: 24px;
  }
  .ai-advisor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; flex-wrap: wrap; gap: 10px; }
  .ai-advisor h3 { color: #fde047; font-size: 15px; }
  .ai-advisor .subtitle { color: #7c7c9a; font-size: 12px; margin-bottom: 8px; }
  .ai-btn {
    background: linear-gradient(135deg, #eab308, #ca8a04);
    border: none; color: #fff; padding: 8px 18px; border-radius: 8px;
    font-size: 13px; cursor: pointer; font-weight: 500; font-family: inherit;
    transition: opacity 0.2s;
  }
  .ai-btn:hover { opacity: 0.9; }
  .ai-btn:disabled { background: #2a2a2a; cursor: default; }
  .ai-result {
    background: #0a0a0a; border-radius: 8px; padding: 16px; margin-top: 12px;
    border-left: 3px solid #eab308; animation: fadeIn 0.3s ease;
  }
  .ai-result pre { color: #cbd5e1; font-size: 13px; line-height: 1.8; white-space: pre-wrap; font-family: inherit; }

  /* Filters */
  .filters {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 20px; flex-wrap: wrap; gap: 12px;
  }
  .filter-cats { display: flex; gap: 8px; flex-wrap: wrap; }
  .cat-btn {
    background: #161616; border: none; color: #94a3b8;
    padding: 6px 14px; border-radius: 6px; font-size: 12px;
    cursor: pointer; font-weight: 500; transition: all 0.2s; font-family: inherit;
  }
  .cat-btn.active { background: #eab308; color: #fff; }
  .cat-btn:hover:not(.active) { background: #2a2a2a; }
  .filter-right { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
  .search-input {
    background: #161616; border: 1px solid #2a2a2a; color: #f1f5f9;
    padding: 7px 14px; border-radius: 8px; font-size: 13px; width: 200px;
    outline: none; font-family: inherit;
  }
  .search-input:focus { border-color: #eab308; }
  .sort-select {
    background: #161616; border: 1px solid #2a2a2a; color: #94a3b8;
    padding: 7px 12px; border-radius: 8px; font-size: 12px;
    outline: none; cursor: pointer; font-family: inherit;
  }
  .compare-btn {
    background: linear-gradient(135deg, #eab308, #ca8a04);
    border: none; color: #fff; padding: 7px 16px; border-radius: 8px;
    font-size: 12px; cursor: pointer; font-weight: 600; white-space: nowrap; font-family: inherit;
  }

  /* Strategy Cards */
  .strategies-list { display: flex; flex-direction: column; gap: 14px; }
  .strategy-card {
    background: #0a0a0a; border: 1px solid #1f1f1f; border-radius: 12px;
    padding: 20px; cursor: pointer; transition: all 0.3s ease;
  }
  .strategy-card:hover { border-color: #2a2a2a; }
  .strategy-card.expanded {
    background: linear-gradient(135deg, #0a0a0a 0%, #111111 100%);
    box-shadow: 0 8px 32px rgba(234,179,8,0.15);
  }
  .strategy-card.compared { border-color: #eab308; }
  .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
  .card-badges { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; flex-wrap: wrap; }
  .badge {
    font-size: 10px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase;
    padding: 3px 8px; border-radius: 4px;
  }
  .badge-cat { color: #eab308; background: rgba(234,179,8,0.1); }
  .badge-easy { color: #22c55e; background: rgba(34,197,94,0.08); }
  .badge-medium { color: #eab308; background: rgba(234,179,8,0.08); }
  .badge-hard { color: #ef4444; background: rgba(239,68,68,0.08); }
  .card-title { color: #f1f5f9; font-size: 17px; font-weight: 600; line-height: 1.3; }
  .toggle-compare-btn {
    background: transparent; border: 1px solid #2a2a2a; color: #64748b;
    border-radius: 6px; padding: 4px 10px; font-size: 11px; cursor: pointer;
    white-space: nowrap; transition: all 0.2s; font-family: inherit; flex-shrink: 0;
  }
  .toggle-compare-btn.active { background: #eab308; border-color: #eab308; color: #fff; }
  .card-desc { color: #94a3b8; font-size: 13px; line-height: 1.6; margin-bottom: 14px; }

  /* Revenue Bar */
  .rev-bar-label { display: flex; justify-content: space-between; font-size: 11px; color: #94a3b8; margin-bottom: 3px; }
  .rev-bar-track { position: relative; height: 8px; background: #161616; border-radius: 4px; overflow: hidden; }
  .rev-bar-fill {
    position: absolute; height: 100%;
    background: linear-gradient(90deg, #ca8a04, #eab308);
    border-radius: 4px; opacity: 0.8;
  }
  .rev-bar-marker { position: absolute; width: 2px; height: 100%; background: #fff; border-radius: 1px; }

  .card-meta { display: flex; gap: 16px; margin-top: 10px; font-size: 12px; flex-wrap: wrap; }
  .meta-time { color: #64748b; }
  .meta-est { color: #eab308; }

  /* Expanded Card Content */
  .expanded-content {
    margin-top: 20px; border-top: 1px solid #1f1f1f; padding-top: 20px;
    animation: fadeIn 0.3s ease;
  }
  .expanded-section { margin-bottom: 18px; }
  .expanded-section h4 {
    font-size: 12px; letter-spacing: 1.2px; text-transform: uppercase; margin-bottom: 8px;
  }
  .impl-box {
    color: #cbd5e1; font-size: 13px; line-height: 1.7;
    background: #161616; padding: 14px; border-radius: 8px;
  }
  .tool-box {
    color: #cbd5e1; font-size: 13px; line-height: 1.7;
    background: #0d0d00; padding: 14px; border-radius: 8px;
    border-left: 3px solid #eab308;
  }
  .pros-cons-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .pros-cons-item {
    color: #94a3b8; font-size: 12px; line-height: 1.6; padding: 4px 0 4px 12px;
  }
  .pros-cons-item.pro { border-left: 2px solid rgba(34,197,94,0.2); }
  .pros-cons-item.con { border-left: 2px solid rgba(239,68,68,0.2); }

  .projection-box {
    margin-top: 18px; background: #111111; border-radius: 8px; padding: 16px;
  }
  .projection-box h4 { color: #eab308; }
  .projection-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; text-align: center; }
  .proj-label { color: #64748b; font-size: 11px; margin-bottom: 4px; }
  .proj-value { font-size: 20px; font-weight: 700; }
  .proj-pct { color: #475569; font-size: 11px; }

  /* Compare Panel Overlay */
  .compare-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85); z-index: 1000; display: flex;
    align-items: center; justify-content: center; padding: 20px;
    backdrop-filter: blur(8px); animation: fadeIn 0.2s ease;
  }
  .compare-panel {
    background: #0a0a0a; border-radius: 16px; padding: 28px; max-width: 1100px;
    width: 100%; max-height: 90vh; overflow-y: auto; border: 1px solid #1f1f1f;
  }
  .compare-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
  .compare-header h2 { color: #f1f5f9; font-size: 22px; }
  .close-btn {
    background: #161616; border: none; color: #94a3b8; width: 36px; height: 36px;
    border-radius: 8px; cursor: pointer; font-size: 18px;
  }
  .compare-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .compare-table th {
    text-align: center; padding: 10px 14px; color: #eab308;
    font-size: 12px; letter-spacing: 0.8px; border-bottom: 1px solid #1f1f1f; font-weight: 600;
  }
  .compare-table th:first-child { text-align: left; }
  .compare-table td {
    text-align: center; padding: 10px 14px; border-bottom: 1px solid rgba(42,42,42,0.3);
  }
  .compare-table td:first-child { color: #94a3b8; font-weight: 500; text-align: left; }

  .combined-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-top: 24px; }
  .combined-card {
    background: #161616; border-radius: 10px; padding: 16px; text-align: center;
  }
  .combined-label { color: #64748b; font-size: 12px; margin-bottom: 6px; }
  .combined-value { font-size: 26px; font-weight: 700; }
  .combined-sub { color: #475569; font-size: 11px; }

  /* Footer */
  .footer {
    margin-top: 28px; background: #0a0a0a; border: 1px solid #1f1f1f;
    border-radius: 12px; padding: 20px; text-align: center;
  }
  .footer p { color: #64748b; font-size: 12px; }
  .footer .disclaimer { color: #475569; font-size: 11px; font-style: italic; margin-top: 6px; }

  /* Settings */
  .settings-btn {
    background: #161616; border: 1px solid #2a2a2a; color: #94a3b8;
    width: 38px; height: 38px; border-radius: 10px; cursor: pointer;
    display: flex; align-items: center; justify-content: center; font-size: 18px;
    transition: all 0.2s; flex-shrink: 0; margin-left: auto;
  }
  .settings-btn:hover { border-color: #eab308; color: #fde047; }
  .settings-btn.has-key { border-color: #22c55e; color: #22c55e; }

  .settings-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85); z-index: 1100; display: flex;
    align-items: center; justify-content: center; padding: 20px;
    backdrop-filter: blur(8px); animation: fadeIn 0.2s ease;
  }
  .settings-panel {
    background: #0a0a0a; border-radius: 16px; padding: 32px; max-width: 560px;
    width: 100%; border: 1px solid #1f1f1f; animation: slideUp 0.3s ease;
  }
  .settings-panel h2 {
    color: #f1f5f9; font-size: 20px; margin-bottom: 4px;
  }
  .settings-panel .settings-sub { color: #64748b; font-size: 13px; margin-bottom: 28px; }

  .setting-group { margin-bottom: 22px; }
  .setting-group label {
    display: block; color: #94a3b8; font-size: 12px; font-weight: 600;
    letter-spacing: 0.8px; text-transform: uppercase; margin-bottom: 8px;
  }
  .setting-group .hint { color: #475569; font-size: 11px; margin-top: 6px; }

  .api-input-wrap {
    position: relative; display: flex; align-items: center;
  }
  .api-input {
    width: 100%; background: #161616; border: 1px solid #2a2a2a; color: #f1f5f9;
    padding: 10px 44px 10px 14px; border-radius: 8px; font-size: 13px;
    font-family: 'Space Mono', monospace; outline: none; transition: border-color 0.2s;
  }
  .api-input:focus { border-color: #eab308; }
  .api-input.valid { border-color: #22c55e; }
  .api-input.invalid { border-color: #ef4444; }
  .api-toggle-vis {
    position: absolute; right: 10px; background: none; border: none;
    color: #64748b; cursor: pointer; font-size: 16px; padding: 4px;
  }
  .api-toggle-vis:hover { color: #94a3b8; }

  .model-select {
    width: 100%; background: #161616; border: 1px solid #2a2a2a; color: #f1f5f9;
    padding: 10px 14px; border-radius: 8px; font-size: 13px; font-family: inherit;
    outline: none; cursor: pointer; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center;
  }
  .model-select:focus { border-color: #eab308; }

  .settings-status {
    display: flex; align-items: center; gap: 8px; padding: 12px 14px;
    border-radius: 8px; font-size: 12px; margin-bottom: 22px;
  }
  .settings-status.connected { background: rgba(34,197,94,0.08); border: 1px solid rgba(34,197,94,0.2); color: #22c55e; }
  .settings-status.disconnected { background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.2); color: #ef4444; }
  .settings-status.none { background: rgba(100,116,139,0.08); border: 1px solid rgba(100,116,139,0.2); color: #94a3b8; }
  .status-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .connected .status-dot { background: #22c55e; }
  .disconnected .status-dot { background: #ef4444; }
  .none .status-dot { background: #64748b; }

  .settings-actions { display: flex; gap: 10px; margin-top: 28px; }
  .btn-save {
    flex: 1; background: linear-gradient(135deg, #eab308, #ca8a04);
    border: none; color: #fff; padding: 10px 20px; border-radius: 8px;
    font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit;
    transition: opacity 0.2s;
  }
  .btn-save:hover { opacity: 0.9; }
  .btn-test {
    background: #161616; border: 1px solid #2a2a2a; color: #94a3b8;
    padding: 10px 20px; border-radius: 8px; font-size: 13px;
    cursor: pointer; font-family: inherit; transition: all 0.2s;
  }
  .btn-test:hover { border-color: #eab308; color: #fde047; }
  .btn-clear {
    background: transparent; border: 1px solid #2a2a2a; color: #ef4444;
    padding: 10px 16px; border-radius: 8px; font-size: 13px;
    cursor: pointer; font-family: inherit; transition: all 0.2s;
  }
  .btn-clear:hover { border-color: #ef4444; background: rgba(239,68,68,0.08); }

  .custom-prompt-input {
    width: 100%; background: #161616; border: 1px solid #2a2a2a; color: #f1f5f9;
    padding: 10px 14px; border-radius: 8px; font-size: 13px; font-family: inherit;
    outline: none; resize: vertical; min-height: 70px; line-height: 1.5;
    transition: border-color 0.2s;
  }
  .custom-prompt-input:focus { border-color: #eab308; }

  .temp-slider-wrap { display: flex; align-items: center; gap: 12px; }
  .temp-slider-wrap input[type=range] { flex: 1; }
  .temp-value { color: #eab308; font-weight: 600; font-size: 14px; min-width: 32px; text-align: right; }

  /* Responsive */
  @media (max-width: 768px) {
    .container { padding: 16px; }
    .header { padding: 20px 16px; }
    .fleet-grid { grid-template-columns: 1fr; gap: 16px; }
    .pros-cons-grid { grid-template-columns: 1fr; }
    .projection-grid { grid-template-columns: 1fr; gap: 8px; }
    .filters { flex-direction: column; align-items: stretch; }
    .filter-right { flex-direction: column; }
    .search-input { width: 100%; }
    .combined-grid { grid-template-columns: 1fr; }
    .compare-table { font-size: 11px; }
    .compare-table th, .compare-table td { padding: 6px 8px; }
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-inner">
    <div class="header-icon">üöó</div>
    <div style="flex:1">
      <h1>Rental Car Pricing Strategy Advisor</h1>
      <p>For use with MarginFuel ¬∑ RateGain ¬∑ Revenue Management Systems</p>
    </div>
    <button class="settings-btn" id="settingsBtn" onclick="openSettings()" title="Settings &amp; API Key">‚öô</button>
  </div>
</div>

<div class="container">
  <!-- Fleet Profile -->
  <div class="fleet-profile">
    <h3>Your Fleet Profile</h3>
    <div class="fleet-grid">
      <div>
        <label>Monthly Revenue: <span id="revLabel">$500,000</span></label>
        <input type="range" id="revSlider" min="50000" max="5000000" step="50000" value="500000">
      </div>
      <div>
        <label>Fleet Size: <span id="fleetLabel">250 vehicles</span></label>
        <input type="range" id="fleetSlider" min="20" max="2000" step="10" value="250">
      </div>
      <div>
        <label>Current Utilization: <span id="utilLabel">72%</span></label>
        <input type="range" id="utilSlider" min="30" max="98" step="1" value="72">
      </div>
    </div>
  </div>

  <!-- AI Advisor -->
  <div class="ai-advisor">
    <div class="ai-advisor-header">
      <h3>ü§ñ AI Strategy Advisor</h3>
      <div style="display:flex;gap:8px;align-items:center;">
        <span id="aiStatusDot" style="width:8px;height:8px;border-radius:50%;background:#64748b;" title="No API key"></span>
        <button class="ai-btn" id="aiBtn" onclick="getAiAdvice()">Get Personalized Advice</button>
      </div>
    </div>
    <p class="subtitle">Uses Claude AI to analyze your fleet profile and recommend the optimal strategy implementation order. <a href="#" onclick="event.preventDefault();openSettings()" style="color:#eab308;">Configure API key ‚Üí</a></p>
    <div id="aiResult" style="display:none;" class="ai-result">
      <pre id="aiText"></pre>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="filter-cats" id="catFilters"></div>
    <div class="filter-right">
      <input type="text" class="search-input" id="searchInput" placeholder="Search strategies..." oninput="renderCards()">
      <select class="sort-select" id="sortSelect" onchange="renderCards()">
        <option value="impact">Sort: Highest Impact</option>
        <option value="difficulty">Sort: Easiest First</option>
        <option value="risk">Sort: Lowest Risk</option>
      </select>
      <button class="compare-btn" id="compareBtn" style="display:none;" onclick="openCompare()">Compare (0)</button>
    </div>
  </div>

  <!-- Strategy Cards -->
  <div class="strategies-list" id="strategiesList"></div>

  <!-- Footer -->
  <div class="footer">
    <p id="footerCount"></p>
    <p class="disclaimer">Revenue estimates are projections based on industry benchmarks. Actual results vary by market, location, fleet mix, and competitive landscape. Always A/B test strategies before full rollout.</p>
  </div>
</div>

<!-- Settings Overlay -->
<div class="settings-overlay" id="settingsOverlay" style="display:none;" onclick="closeSettings(event)">
  <div class="settings-panel" onclick="event.stopPropagation()">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px;">
      <div>
        <h2>‚öô Settings</h2>
        <p class="settings-sub">Configure your Claude API connection for AI-powered recommendations.</p>
      </div>
      <button class="close-btn" onclick="closeSettings()" style="flex-shrink:0">&times;</button>
    </div>

    <div class="settings-status none" id="connStatus">
      <div class="status-dot"></div>
      <span id="connStatusText">No API key configured</span>
    </div>

    <div class="setting-group">
      <label>Claude API Key</label>
      <div class="api-input-wrap">
        <input type="password" class="api-input" id="apiKeyInput" placeholder="sk-ant-api03-..." autocomplete="off" spellcheck="false">
        <button class="api-toggle-vis" id="apiToggleBtn" onclick="toggleApiVis()">üëÅ</button>
      </div>
      <p class="hint">Your key is stored locally in your browser only. Get one at <a href="https://console.anthropic.com/settings/keys" target="_blank" style="color:#eab308;">console.anthropic.com</a></p>
    </div>

    <div class="setting-group">
      <label>Model</label>
      <select class="model-select" id="modelSelect">
        <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (Fast & Capable)</option>
        <option value="claude-opus-4-6">Claude Opus 4.6 (Most Intelligent)</option>
        <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5 (Fastest & Cheapest)</option>
      </select>
      <p class="hint">Sonnet recommended for best balance of speed and quality.</p>
    </div>

    <div class="setting-group">
      <label>Temperature</label>
      <div class="temp-slider-wrap">
        <input type="range" id="tempSlider" min="0" max="100" step="5" value="30">
        <span class="temp-value" id="tempValue">0.3</span>
      </div>
      <p class="hint">Lower = more focused. Higher = more creative. 0.3 is recommended.</p>
    </div>

    <div class="setting-group">
      <label>Custom Business Context (Optional)</label>
      <textarea class="custom-prompt-input" id="customPrompt" placeholder="E.g.: We operate 3 airport locations in Florida, primarily leisure travelers. Peak season is Dec-Apr. We use MarginFuel."></textarea>
      <p class="hint">Included in every AI recommendation to make advice more specific.</p>
    </div>

    <div class="settings-actions">
      <button class="btn-test" onclick="testConnection()">Test Connection</button>
      <button class="btn-save" onclick="saveSettings()">Save Settings</button>
      <button class="btn-clear" onclick="clearSettings()">Clear</button>
    </div>
  </div>
</div>

<!-- Compare Overlay -->
<div class="compare-overlay" id="compareOverlay" style="display:none;" onclick="closeCompare(event)">
  <div class="compare-panel" onclick="event.stopPropagation()">
    <div class="compare-header">
      <h2>Strategy Comparison</h2>
      <button class="close-btn" onclick="closeCompare()">&times;</button>
    </div>
    <div style="overflow-x:auto;" id="compareContent"></div>
  </div>
</div>

<script>
const STRATEGIES = [
  {
    id:1, category:"Dynamic Pricing", name:"Demand-Based Surge Pricing",
    description:"Automatically increase rates during high-demand periods (holidays, weekends, events) and decrease during low-demand windows. Configure thresholds in MarginFuel/RateGain based on utilization targets.",
    implementation:"Set utilization-based pricing tiers: 0-60% = base rate, 60-80% = +15-25%, 80-90% = +30-50%, 90%+ = +60-100%. Apply per vehicle class and location.",
    toolConfig:"In MarginFuel: Configure 'Demand Multiplier' rules under Dynamic Pricing ‚Üí Utilization Triggers. In RateGain: Use 'Demand Intelligence' module with auto-adjustment bands.",
    pros:["Maximizes revenue during peak periods","Reduces idle fleet during low demand","Automated pricing reduces manual workload","Responsive to real-time market conditions"],
    cons:["Can alienate price-sensitive customers","Risk of overpricing in volatile markets","Requires accurate demand forecasting data","Competitor undercutting during surges"],
    revImpact:{low:8,mid:15,high:25}, difficulty:"Medium", timeToImplement:"1-2 weeks", riskLevel:"Medium",
    tags:["automation","revenue","peak"]
  },
  {
    id:2, category:"Dynamic Pricing", name:"Length-of-Rental (LOR) Optimization",
    description:"Offer progressive discounts for longer rental periods to improve utilization and reduce turnaround costs. Structure rates to incentivize 5-7+ day rentals over 1-2 day bookings.",
    implementation:"Create tiered daily rate structures: 1-2 days = premium rate, 3-4 days = -10%, 5-6 days = -18%, 7-13 days = -25%, 14-20 days = -30%, 21+ days = -35-40%. Adjust by class.",
    toolConfig:"In MarginFuel: Set up 'LOR Discount Curves' under Rate Structures ‚Üí Duration-Based Rules. In RateGain: Configure 'Stay Length Incentives' within pricing templates.",
    pros:["Increases average rental duration","Reduces fleet turnaround/cleaning costs","More predictable revenue per vehicle","Competitive against monthly rental alternatives"],
    cons:["Lower daily yield on extended rentals","Can cannibalize higher-margin short rentals","Complex rate card management","May conflict with fleet rotation schedules"],
    revImpact:{low:5,mid:10,high:18}, difficulty:"Easy", timeToImplement:"3-5 days", riskLevel:"Low",
    tags:["utilization","loyalty","cost-reduction"]
  },
  {
    id:3, category:"Competitive Intelligence", name:"Competitive Rate Parity / Undercutting",
    description:"Monitor competitor rates in real-time and automatically adjust to maintain a defined price position (match, undercut by X%, or premium positioning) relative to key competitors.",
    implementation:"Define competitor set per location. Set position rules: e.g., undercut Hertz/Avis by 5-8%, match Enterprise, price 10% above Budget. Set floor rates to protect margins.",
    toolConfig:"In MarginFuel: Use 'Competitive Intelligence' dashboard ‚Üí Auto-Match Rules. In RateGain: Configure 'Rate Shopping' with automated response rules and floor/ceiling guards.",
    pros:["Maintains competitive market position","Real-time responsiveness to market shifts","Data-driven rather than gut-feel pricing","Prevents significant rate disparity losses"],
    cons:["Risk of race-to-bottom pricing wars","Requires reliable competitor data feeds","May sacrifice margin chasing volume","Floor rates must be carefully calibrated"],
    revImpact:{low:4,mid:12,high:20}, difficulty:"Medium", timeToImplement:"1-3 weeks", riskLevel:"Medium-High",
    tags:["competitive","automation","market-share"]
  },
  {
    id:4, category:"Segmentation", name:"Channel-Based Rate Differentiation",
    description:"Set different rate strategies per distribution channel ‚Äî direct website, OTAs (Kayak, Priceline), corporate portals, walk-ins, and call center. Incentivize direct bookings with best-rate guarantees.",
    implementation:"Direct web = best rate (base). OTAs = base + 10-15% (to offset commission). Corporate = negotiated -8-15% from rack. Walk-in = premium +20-30%. Call center = match web rate.",
    toolConfig:"In MarginFuel: Configure 'Channel Management' ‚Üí Rate Differentials per distribution source. In RateGain: Use 'Channel Optimizer' to set channel-specific pricing layers.",
    pros:["Optimizes margin per channel after commissions","Drives direct bookings (lower acquisition cost)","Tailored pricing for different customer segments","Better control over rate integrity"],
    cons:["Rate parity violations may upset OTA partners","Complex multi-channel rate management","Risk of customer confusion across channels","OTA delisting risk if spread is too large"],
    revImpact:{low:6,mid:11,high:16}, difficulty:"Medium", timeToImplement:"2-4 weeks", riskLevel:"Medium",
    tags:["distribution","margin","direct-booking"]
  },
  {
    id:5, category:"Segmentation", name:"Vehicle Class Yield Management",
    description:"Dynamically manage pricing gaps between vehicle classes to encourage upsells and maximize per-unit revenue. When economy is nearly sold out, narrow the gap to midsize; when SUVs are oversupplied, tighten gap to sedans.",
    implementation:"Maintain class ladders with dynamic gaps: Economy‚ÜíCompact ($5-10), Compact‚ÜíMidsize ($8-12), Midsize‚ÜíFullsize ($10-15), Fullsize‚ÜíSUV ($15-25), SUV‚ÜíPremium ($20-40). Compress when higher class >70% available.",
    toolConfig:"In MarginFuel: Use 'Class Yield Rules' under Fleet Optimization ‚Üí Inter-Class Gap Management. In RateGain: Configure 'Upgrade Ladder' rules in the yield management module.",
    pros:["Maximizes revenue from available fleet mix","Natural upsell engine without sales pressure","Reduces oversupply of premium classes","Improves perceived value for customers"],
    cons:["Complex to maintain across all locations","Can confuse customers if gaps shift frequently","Requires real-time fleet availability data","May reduce revenue if gaps compress too aggressively"],
    revImpact:{low:7,mid:13,high:22}, difficulty:"Hard", timeToImplement:"2-4 weeks", riskLevel:"Medium",
    tags:["upsell","fleet","yield"]
  },
  {
    id:6, category:"Ancillary Revenue", name:"Bundled Protection & Add-On Pricing",
    description:"Create attractive bundles of insurance, GPS, child seats, and roadside assistance at a slight discount vs. √† la carte pricing. Use dynamic bundle pricing based on rental length and vehicle class.",
    implementation:"Create 3 tiers: Basic (CDW only, +$12/day), Plus (CDW + roadside + GPS, +$22/day, saves $8), Premium (all protections + extras, +$32/day, saves $15). Offer at booking and check-in.",
    toolConfig:"Configure ancillary pricing in your PMS/RMS and link to MarginFuel/RateGain rate outputs. Most tools support add-on bundle rules in the 'Ancillary Revenue' or 'Product Configuration' module.",
    pros:["Significant ancillary revenue uplift (20-40%)","Higher perceived value drives conversion","Simplifies customer decision-making","Reduces counter upsell friction"],
    cons:["Revenue dilution vs √† la carte for some customers","Regulatory complexity on insurance products","Requires clear disclosure to avoid complaints","Bundle fatigue if options are too complex"],
    revImpact:{low:10,mid:18,high:30}, difficulty:"Easy", timeToImplement:"1-2 weeks", riskLevel:"Low",
    tags:["ancillary","bundles","conversion"]
  },
  {
    id:7, category:"Dynamic Pricing", name:"Advance Purchase / Last-Minute Pricing",
    description:"Implement a booking window-based pricing curve. Reward early bookers with lower rates to secure base demand, then increase rates as pickup date approaches to capture last-minute willingness-to-pay.",
    implementation:"30+ days out = -15-20% early bird. 14-29 days = base rate. 7-13 days = +10-15%. 3-6 days = +20-30%. 0-2 days = +35-60%. Apply per location and season. Combine with cancellation policies.",
    toolConfig:"In MarginFuel: Configure 'Booking Window Curves' under Dynamic Pricing ‚Üí Time-to-Pickup Rules. In RateGain: Use 'Advance Purchase' pricing tier setup with sliding rate adjustments.",
    pros:["Secures base demand early for better planning","Captures premium from last-minute travelers","Smooths booking curve for operations","Flexible cancellation can protect early discounts"],
    cons:["Early bookers may rebook if rates drop","Last-minute premium may push to competitors","Complex rate fence management","Cancellation policy must balance flexibility vs commitment"],
    revImpact:{low:6,mid:12,high:20}, difficulty:"Medium", timeToImplement:"1-2 weeks", riskLevel:"Low-Medium",
    tags:["booking-window","revenue","planning"]
  },
  {
    id:8, category:"Competitive Intelligence", name:"Geographic / Airport vs. Off-Airport Pricing",
    description:"Differentiate pricing strategies between airport locations (higher demand, less price-sensitive) and off-airport/downtown locations (more competitive, loyalty-driven). Apply location-specific rules.",
    implementation:"Airport locations: premium +15-25% base, aggressive surge pricing, higher walk-in premiums. Off-airport: competitive base rates, stronger loyalty discounts, LOR incentives, local corporate focus.",
    toolConfig:"In MarginFuel: Use 'Location Groups' to segment rules by airport vs off-airport. In RateGain: Configure 'Location-Based Strategies' with separate rule sets per location type.",
    pros:["Tailored strategy per demand profile","Captures airport premium willingness-to-pay","Off-airport competitiveness drives volume","Better fleet allocation across locations"],
    cons:["Increased management complexity","Customers may compare across locations","Airport fees/concessions eat into premium","Requires granular location-level data"],
    revImpact:{low:5,mid:10,high:17}, difficulty:"Medium", timeToImplement:"2-3 weeks", riskLevel:"Low",
    tags:["location","segmentation","airport"]
  },
  {
    id:9, category:"Ancillary Revenue", name:"One-Way / Drop-Off Fee Optimization",
    description:"Dynamically price one-way rentals based on fleet rebalancing needs. Reduce or waive drop-off fees on routes that help reposition fleet, and increase fees on routes that create imbalances.",
    implementation:"Identify surplus/deficit locations weekly. Routes that help rebalance: waive or reduce drop-off fee (-50-100%). Routes that worsen imbalance: premium drop-off fee ($75-200+). Automate based on fleet position data.",
    toolConfig:"Configure one-way rules in your fleet management system and link pricing to MarginFuel/RateGain. Use 'One-Way Pricing' or 'Repositioning Incentive' modules if available.",
    pros:["Reduces costly fleet repositioning drives","Opens new revenue from one-way demand","Improves fleet utilization at all locations","Competitive advantage on popular one-way routes"],
    cons:["Complex logistics and fleet tracking required","Customer confusion on variable drop-off fees","Difficult to forecast one-way demand accurately","Can create unexpected fleet shortages"],
    revImpact:{low:3,mid:8,high:14}, difficulty:"Hard", timeToImplement:"3-6 weeks", riskLevel:"Medium",
    tags:["fleet","logistics","one-way"]
  },
  {
    id:10, category:"Segmentation", name:"Corporate / Negotiated Rate Tiering",
    description:"Structure corporate rate programs with volume-based tiers rather than flat discounts. Reward high-volume accounts with deeper discounts while protecting margin on smaller accounts.",
    implementation:"Tier 1 (50+ days/mo): -18-22% off rack. Tier 2 (20-49 days/mo): -12-16%. Tier 3 (5-19 days/mo): -6-10%. Include free upgrades at Tier 1 as loyalty perk. Annual review with volume commitments.",
    toolConfig:"Configure in your corporate booking portal/CRM. Link negotiated rates to MarginFuel/RateGain as 'Protected Rates' or 'Contract Rates' that override dynamic pricing within set parameters.",
    pros:["Locks in predictable base demand","Rewards loyalty proportional to value","Protects margin on smaller accounts","Strengthens long-term B2B relationships"],
    cons:["Volume commitments may not materialize","Administrative overhead for tier management","Risk of channel conflict with public rates","Deep discounts reduce per-unit revenue"],
    revImpact:{low:4,mid:9,high:15}, difficulty:"Medium", timeToImplement:"3-6 weeks", riskLevel:"Low",
    tags:["corporate","B2B","loyalty"]
  },
  {
    id:11, category:"Dynamic Pricing", name:"Day-of-Week Pricing Patterns",
    description:"Apply systematic rate adjustments based on day-of-week demand patterns. Business locations premium on weekdays, leisure/airport locations premium on weekends and holidays.",
    implementation:"Business locations: Mon-Thu = base +10-15%, Fri-Sun = base -10-15%. Leisure/airport: Fri-Sun = base +15-25%, Mon-Thu = base -5-10%. Overlay with holiday calendar for additional premiums.",
    toolConfig:"In MarginFuel: Use 'Calendar-Based Rules' under Dynamic Pricing ‚Üí Day-of-Week Adjustments. In RateGain: Configure 'Weekly Pattern' templates per location group.",
    pros:["Captures predictable demand patterns","Easy to implement and understand","Low risk ‚Äî based on well-known patterns","Works well as a pricing foundation layer"],
    cons:["Can be too rigid for unusual weeks","Doesn't account for specific events","May conflict with other dynamic rules","Requires location-level pattern analysis"],
    revImpact:{low:4,mid:8,high:14}, difficulty:"Easy", timeToImplement:"3-5 days", riskLevel:"Low",
    tags:["calendar","patterns","foundation"]
  },
  {
    id:12, category:"Ancillary Revenue", name:"Fuel Service Option Pricing",
    description:"Optimize prepaid fuel option pricing to be attractive vs. local pump prices while generating margin. Offer tiered fuel options: prepaid full tank, pay-on-return, or fuel service charge.",
    implementation:"Prepaid fuel: local pump price -5-10% (volume discount appeal). Return empty fee: local price +$2-3/gallon premium. Fuel service charge (we fill): +$9.99 flat + pump price. Market test per location.",
    toolConfig:"Configure fuel pricing in your PMS. Link to MarginFuel/RateGain as an ancillary layer. Some tools offer 'Fuel Pricing Intelligence' modules that track local pump prices.",
    pros:["High-margin ancillary revenue stream","Customers value convenience of prepaid","Reduces return inspection disputes","Easy to automate and scale"],
    cons:["Customer perception of unfair fuel charges","Prepaid fuel: customer loses unused fuel value","Local price tracking adds operational complexity","Regulatory scrutiny on fuel pricing transparency"],
    revImpact:{low:3,mid:6,high:10}, difficulty:"Easy", timeToImplement:"1 week", riskLevel:"Low",
    tags:["ancillary","fuel","convenience"]
  }
];

const CATEGORIES = [...new Set(STRATEGIES.map(s => s.category))];

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let monthlyRevenue = 500000;
let fleetSize = 250;
let utilization = 72;
let expandedId = null;
let compareIds = [];

// ‚îÄ‚îÄ‚îÄ SETTINGS STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let apiKey = '';
let selectedModel = 'claude-sonnet-4-20250514';
let temperature = 0.3;
let customPrompt = '';
let connectionStatus = 'none';

function loadSettings() {
  try {
    const saved = localStorage.getItem('rc_pricing_settings');
    if (saved) {
      const s = JSON.parse(saved);
      apiKey = s.apiKey || '';
      selectedModel = s.model || 'claude-sonnet-4-20250514';
      temperature = s.temperature ?? 0.3;
      customPrompt = s.customPrompt || '';
      if (apiKey) connectionStatus = 'connected';
    }
  } catch(e) {}
  updateSettingsUI();
}

function saveSettings() {
  apiKey = document.getElementById('apiKeyInput').value.trim();
  selectedModel = document.getElementById('modelSelect').value;
  temperature = parseFloat(document.getElementById('tempSlider').value) / 100;
  customPrompt = document.getElementById('customPrompt').value.trim();
  try { localStorage.setItem('rc_pricing_settings', JSON.stringify({ apiKey, model: selectedModel, temperature, customPrompt })); } catch(e) {}
  connectionStatus = apiKey ? 'connected' : 'none';
  updateSettingsUI(); updateSettingsBtn(); updateAiDot();
  const btn = document.querySelector('.btn-save');
  btn.textContent = '‚úì Saved!'; btn.style.background = '#22c55e';
  setTimeout(() => { btn.textContent = 'Save Settings'; btn.style.background = ''; }, 1500);
}

function clearSettings() {
  if (!confirm('Clear your API key and all settings?')) return;
  apiKey = ''; selectedModel = 'claude-sonnet-4-20250514'; temperature = 0.3; customPrompt = '';
  connectionStatus = 'none';
  try { localStorage.removeItem('rc_pricing_settings'); } catch(e) {}
  updateSettingsUI(); updateSettingsBtn(); updateAiDot();
}

async function testConnection() {
  const key = document.getElementById('apiKeyInput').value.trim();
  if (!key) { alert('Please enter an API key first.'); return; }
  const btn = document.querySelector('.btn-test');
  btn.textContent = 'Testing...'; btn.disabled = true;
  try {
    const resp = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json", "x-api-key": key, "anthropic-version": "2023-06-01", "anthropic-dangerous-direct-browser-access": "true" },
      body: JSON.stringify({ model: document.getElementById('modelSelect').value, max_tokens: 50, messages: [{ role: "user", content: "Reply: OK" }] })
    });
    if (resp.ok) {
      connectionStatus = 'connected';
      btn.textContent = '‚úì Connected!'; btn.style.color = '#22c55e'; btn.style.borderColor = '#22c55e';
    } else {
      const err = await resp.json().catch(() => ({}));
      connectionStatus = 'disconnected';
      btn.textContent = '‚úó Failed'; btn.style.color = '#ef4444'; btn.style.borderColor = '#ef4444';
      alert('Failed: ' + (err.error?.message || 'HTTP ' + resp.status));
    }
  } catch (err) {
    connectionStatus = 'disconnected';
    btn.textContent = '‚úó Error'; btn.style.color = '#ef4444'; btn.style.borderColor = '#ef4444';
    alert('Error: ' + err.message);
  }
  updateSettingsUI(); updateAiDot();
  setTimeout(() => { btn.textContent = 'Test Connection'; btn.style.color = ''; btn.style.borderColor = ''; btn.disabled = false; }, 2000);
}

function updateSettingsUI() {
  const el = document.getElementById('connStatus');
  const txt = document.getElementById('connStatusText');
  el.className = 'settings-status ' + connectionStatus;
  txt.textContent = connectionStatus === 'connected' ? 'API key configured ‚Äî ready to go' : connectionStatus === 'disconnected' ? 'Connection failed ‚Äî check your API key' : 'No API key configured';
  document.getElementById('apiKeyInput').value = apiKey;
  document.getElementById('modelSelect').value = selectedModel;
  document.getElementById('tempSlider').value = Math.round(temperature * 100);
  document.getElementById('tempValue').textContent = temperature.toFixed(1);
  document.getElementById('customPrompt').value = customPrompt;
  const inp = document.getElementById('apiKeyInput');
  inp.className = 'api-input' + (apiKey && apiKey.startsWith('sk-') ? ' valid' : apiKey ? ' invalid' : '');
}

function updateSettingsBtn() {
  document.getElementById('settingsBtn').className = 'settings-btn' + (apiKey ? ' has-key' : '');
}

function updateAiDot() {
  const dot = document.getElementById('aiStatusDot');
  if (apiKey && connectionStatus === 'connected') { dot.style.background = '#22c55e'; dot.title = 'API connected'; }
  else if (connectionStatus === 'disconnected') { dot.style.background = '#ef4444'; dot.title = 'Connection failed'; }
  else { dot.style.background = '#64748b'; dot.title = 'No API key'; }
}

function openSettings() { updateSettingsUI(); document.getElementById('settingsOverlay').style.display = 'flex'; }
function closeSettings(e) { if (!e || e.target === document.getElementById('settingsOverlay')) document.getElementById('settingsOverlay').style.display = 'none'; }
function toggleApiVis() {
  const inp = document.getElementById('apiKeyInput');
  const btn = document.getElementById('apiToggleBtn');
  if (inp.type === 'password') { inp.type = 'text'; btn.textContent = 'üôà'; } else { inp.type = 'password'; btn.textContent = 'üëÅ'; }
}
document.getElementById('tempSlider').addEventListener('input', e => { document.getElementById('tempValue').textContent = (e.target.value / 100).toFixed(1); });

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fmt(n) { return n.toLocaleString(); }
function diffColor(d) { return d === "Easy" ? "#22c55e" : d === "Medium" ? "#eab308" : "#ef4444"; }
function riskColor(r) { return r.includes("Low") && !r.includes("Medium") ? "#22c55e" : r.includes("High") ? "#ef4444" : "#eab308"; }
function diffClass(d) { return d === "Easy" ? "badge-easy" : d === "Medium" ? "badge-medium" : "badge-hard"; }

// ‚îÄ‚îÄ‚îÄ SLIDERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('revSlider').addEventListener('input', e => {
  monthlyRevenue = +e.target.value;
  document.getElementById('revLabel').textContent = '$' + fmt(monthlyRevenue);
  renderCards();
});
document.getElementById('fleetSlider').addEventListener('input', e => {
  fleetSize = +e.target.value;
  document.getElementById('fleetLabel').textContent = fleetSize + ' vehicles';
});
document.getElementById('utilSlider').addEventListener('input', e => {
  utilization = +e.target.value;
  const el = document.getElementById('utilLabel');
  el.textContent = utilization + '%';
  el.style.color = utilization > 80 ? '#22c55e' : utilization > 60 ? '#eab308' : '#ef4444';
});

// ‚îÄ‚îÄ‚îÄ CATEGORY FILTERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildCatFilters() {
  const wrap = document.getElementById('catFilters');
  ['All', ...CATEGORIES].forEach(c => {
    const b = document.createElement('button');
    b.className = 'cat-btn' + (c === 'All' ? ' active' : '');
    b.textContent = c;
    b.onclick = () => { document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active')); b.classList.add('active'); renderCards(); };
    wrap.appendChild(b);
  });
}
function getActiveCat() { const a = document.querySelector('.cat-btn.active'); return a ? a.textContent : 'All'; }

// ‚îÄ‚îÄ‚îÄ RENDER CARDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCards() {
  const cat = getActiveCat();
  const search = document.getElementById('searchInput').value.toLowerCase();
  const sort = document.getElementById('sortSelect').value;
  let list = STRATEGIES.filter(s => cat === 'All' || s.category === cat)
    .filter(s => s.name.toLowerCase().includes(search) || s.description.toLowerCase().includes(search) || s.tags.some(t => t.includes(search)));
  if (sort === 'impact') list.sort((a, b) => b.revImpact.mid - a.revImpact.mid);
  else if (sort === 'difficulty') { const o = {Easy:0,Medium:1,Hard:2}; list.sort((a,b) => o[a.difficulty] - o[b.difficulty]); }
  else if (sort === 'risk') { const o = {Low:0,"Low-Medium":1,Medium:2,"Medium-High":3,High:4}; list.sort((a,b) => o[a.riskLevel] - o[b.riskLevel]); }
  document.getElementById('strategiesList').innerHTML = list.map(s => buildCard(s)).join('');
  document.getElementById('footerCount').textContent = STRATEGIES.length + ' strategies across ' + CATEGORIES.length + ' categories';
  updateCompareBtn();
}

function buildCard(s) {
  const isExp = expandedId === s.id, isCmp = compareIds.includes(s.id);
  const rL = Math.round(monthlyRevenue * s.revImpact.low / 100);
  const rM = Math.round(monthlyRevenue * s.revImpact.mid / 100);
  const rH = Math.round(monthlyRevenue * s.revImpact.high / 100);
  return `<div class="strategy-card ${isExp?'expanded':''} ${isCmp?'compared':''}" onclick="toggleExpand(${s.id})">
    <div class="card-top"><div style="flex:1">
      <div class="card-badges"><span class="badge badge-cat">${s.category}</span><span class="badge ${diffClass(s.difficulty)}">${s.difficulty}</span></div>
      <div class="card-title">${s.name}</div>
    </div>
    <button class="toggle-compare-btn ${isCmp?'active':''}" onclick="event.stopPropagation();toggleCompare(${s.id})">${isCmp?'‚úì Comparing':'+ Compare'}</button></div>
    <p class="card-desc">${s.description}</p>
    <div style="margin-bottom:6px"><div class="rev-bar-label"><span>Estimated Revenue Impact</span><span>${s.revImpact.low}% ‚Äì ${s.revImpact.high}%</span></div>
    <div class="rev-bar-track"><div class="rev-bar-fill" style="left:${s.revImpact.low}%;width:${s.revImpact.high-s.revImpact.low}%"></div><div class="rev-bar-marker" style="left:${s.revImpact.mid}%"></div></div></div>
    <div class="card-meta"><span class="meta-time">‚è± ${s.timeToImplement}</span><span style="color:${riskColor(s.riskLevel)}">‚ö° Risk: ${s.riskLevel}</span><span class="meta-est">Est: +$${fmt(rL)} ‚Äì $${fmt(rH)}/mo</span></div>
    ${isExp ? buildExpanded(s, rL, rM, rH) : ''}</div>`;
}

function buildExpanded(s, rL, rM, rH) {
  return `<div class="expanded-content">
    <div class="expanded-section"><h4 style="color:#eab308">Implementation Guide</h4><div class="impl-box">${s.implementation}</div></div>
    <div class="expanded-section"><h4 style="color:#eab308">Tool Configuration (MarginFuel / RateGain)</h4><div class="tool-box">${s.toolConfig}</div></div>
    <div class="pros-cons-grid"><div><h4 style="color:#22c55e">‚úì Advantages</h4>${s.pros.map(p=>`<div class="pros-cons-item pro">${p}</div>`).join('')}</div>
    <div><h4 style="color:#ef4444">‚úó Risks & Trade-offs</h4>${s.cons.map(c=>`<div class="pros-cons-item con">${c}</div>`).join('')}</div></div>
    <div class="projection-box"><h4 style="color:#eab308;font-size:12px;letter-spacing:1.2px;text-transform:uppercase;margin-bottom:10px">Projected Monthly Revenue Impact</h4>
    <div class="projection-grid">
      <div><div class="proj-label">Conservative</div><div class="proj-value" style="color:#22c55e">+$${fmt(rL)}</div><div class="proj-pct">${s.revImpact.low}% uplift</div></div>
      <div><div class="proj-label">Expected</div><div class="proj-value" style="color:#eab308">+$${fmt(rM)}</div><div class="proj-pct">${s.revImpact.mid}% uplift</div></div>
      <div><div class="proj-label">Optimistic</div><div class="proj-value" style="color:#eab308">+$${fmt(rH)}</div><div class="proj-pct">${s.revImpact.high}% uplift</div></div>
    </div></div></div>`;
}

// ‚îÄ‚îÄ‚îÄ EXPAND / COMPARE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleExpand(id) { expandedId = expandedId === id ? null : id; renderCards(); }
function toggleCompare(id) {
  if (compareIds.includes(id)) compareIds = compareIds.filter(x => x !== id);
  else if (compareIds.length < 4) compareIds.push(id);
  renderCards();
}
function updateCompareBtn() {
  const btn = document.getElementById('compareBtn');
  btn.style.display = compareIds.length > 0 ? 'inline-block' : 'none';
  btn.textContent = 'Compare (' + compareIds.length + ')';
}
function openCompare() {
  const strats = STRATEGIES.filter(s => compareIds.includes(s.id));
  const rows = [
    {label:'Category',fn:s=>s.category,color:()=>'#cbd5e1'},{label:'Difficulty',fn:s=>s.difficulty,color:s=>diffColor(s.difficulty)},
    {label:'Risk Level',fn:s=>s.riskLevel,color:s=>riskColor(s.riskLevel)},{label:'Time to Implement',fn:s=>s.timeToImplement,color:()=>'#cbd5e1'},
    {label:'Rev Impact (Expected)',fn:s=>s.revImpact.mid+'%',color:()=>'#eab308'},
    {label:'Est. Monthly Uplift',fn:s=>'+$'+fmt(Math.round(monthlyRevenue*s.revImpact.mid/100))+'/mo',color:()=>'#22c55e'}
  ];
  let h = `<table class="compare-table"><thead><tr><th>Metric</th>${strats.map(s=>`<th style="max-width:220px">${s.name}</th>`).join('')}</tr></thead><tbody>`;
  rows.forEach(r => { h += `<tr><td>${r.label}</td>${strats.map(s=>`<td style="color:${r.color(s)}">${r.fn(s)}</td>`).join('')}</tr>`; });
  h += '</tbody></table>';
  h += '<h3 style="color:#f1f5f9;font-size:15px;margin-top:24px;margin-bottom:16px">Combined Revenue Potential</h3><div class="combined-grid">';
  ['Conservative','Expected','Optimistic'].forEach((l,i) => {
    const k = ['low','mid','high'][i], t = strats.reduce((s,x) => s+Math.round(monthlyRevenue*x.revImpact[k]/100),0), c = ['#22c55e','#eab308','#fbbf24'];
    h += `<div class="combined-card"><div class="combined-label">${l} Combined</div><div class="combined-value" style="color:${c[i]}">+$${fmt(t)}</div><div class="combined-sub">per month</div></div>`;
  });
  h += '</div><p style="color:#64748b;font-size:11px;margin-top:12px;font-style:italic">Note: Combined estimates assume partial overlap. Actual combined impact may be 60-80% of sum due to interaction effects.</p>';
  document.getElementById('compareContent').innerHTML = h;
  document.getElementById('compareOverlay').style.display = 'flex';
}
function closeCompare(e) { if (!e || e.target === document.getElementById('compareOverlay')) document.getElementById('compareOverlay').style.display = 'none'; }

// ‚îÄ‚îÄ‚îÄ AI ADVISOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function getAiAdvice() {
  if (!apiKey) { openSettings(); return; }
  const btn = document.getElementById('aiBtn'), result = document.getElementById('aiResult'), text = document.getElementById('aiText');
  btn.disabled = true; btn.textContent = 'Analyzing...';
  result.style.display = 'block'; text.textContent = 'Generating personalized recommendations...'; text.style.animation = 'pulse 1.5s infinite';
  const biz = customPrompt ? '\n\nAdditional business context: ' + customPrompt : '';
  try {
    const resp = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json", "x-api-key": apiKey, "anthropic-version": "2023-06-01", "anthropic-dangerous-direct-browser-access": "true" },
      body: JSON.stringify({
        model: selectedModel, max_tokens: 1500, temperature: temperature,
        messages: [{ role: "user", content: `You are a rental car pricing expert and revenue management consultant. Given this fleet profile:
- Monthly revenue: $${fmt(monthlyRevenue)}
- Fleet size: ${fleetSize} vehicles
- Current utilization: ${utilization}%${biz}

Available pricing strategies: ${STRATEGIES.map(s => s.name + ' (' + s.category + ', ' + s.difficulty + ', ' + s.revImpact.mid + '% expected impact)').join(", ")}

Provide a strategic recommendation:
1. Top 3 strategies to implement IN ORDER of priority
2. For each, explain WHY it fits this specific fleet profile
3. Suggest a phased implementation timeline
4. Flag any strategies to AVOID given the current profile
5. Estimate combined realistic revenue uplift

Keep it practical and actionable. Use plain text, no markdown.` }]
      })
    });
    if (!resp.ok) { const e = await resp.json().catch(()=>({})); throw new Error(e.error?.message || 'HTTP ' + resp.status); }
    const data = await resp.json();
    text.style.animation = 'none';
    text.textContent = data.content.map(c => c.text || '').join('\n');
    const labels = { 'claude-sonnet-4-20250514': 'Sonnet 4', 'claude-opus-4-6': 'Opus 4.6', 'claude-haiku-4-5-20251001': 'Haiku 4.5' };
    text.textContent += '\n\n‚Äî Generated by ' + (labels[selectedModel] || selectedModel);
  } catch (err) {
    text.style.animation = 'none';
    if (err.message.includes('401') || err.message.includes('invalid')) {
      text.textContent = '‚ùå API Authentication Error: ' + err.message + '\n\nCheck your API key in Settings (gear icon).';
      connectionStatus = 'disconnected'; updateSettingsBtn(); updateAiDot();
    } else {
      text.textContent = '‚ùå Error: ' + err.message + '\n\nFallback: Based on ' + utilization + '% utilization:\n' +
        (utilization < 70 ? '‚Ä¢ Priority 1: LOR Optimization\n‚Ä¢ Priority 2: Advance Purchase Pricing\n‚Ä¢ Priority 3: Day-of-Week Patterns'
        : utilization > 85 ? '‚Ä¢ Priority 1: Demand-Based Surge Pricing\n‚Ä¢ Priority 2: Vehicle Class Yield Management\n‚Ä¢ Priority 3: Bundled Protection Pricing'
        : '‚Ä¢ Priority 1: Day-of-Week Patterns\n‚Ä¢ Priority 2: Bundled Protection & Add-On Pricing\n‚Ä¢ Priority 3: Channel-Based Rate Differentiation');
    }
  }
  btn.disabled = false; btn.textContent = 'Get Personalized Advice';
}

// ‚îÄ‚îÄ‚îÄ KEYBOARD & INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') { document.getElementById('compareOverlay').style.display = 'none'; document.getElementById('settingsOverlay').style.display = 'none'; }
});

loadSettings();
updateSettingsBtn();
updateAiDot();
buildCatFilters();
renderCards();
</script>
</body>
</html>
